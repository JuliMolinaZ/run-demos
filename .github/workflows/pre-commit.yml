name: Pre-commit Security Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  security-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Check for sensitive files
        run: |
          # Verificar archivos .env (sin extensión)
          if git ls-files | grep -q "^\.env$"; then
            echo "❌ ERROR: Archivo .env detectado"
            exit 1
          fi
          # Verificar archivos .env.* pero PERMITIR .env.*.example (plantillas)
          ENV_FILES=$(git ls-files | grep -E "\.env\." | grep -v "\.example$" | grep -v "\.example\." || true)
          if [ -n "$ENV_FILES" ]; then
            echo "❌ ERROR: Archivos .env.* detectados (excepto plantillas .example)"
            echo "$ENV_FILES"
            exit 1
          fi
          echo "✅ No se encontraron archivos sensibles"
      
      - name: Check for hardcoded secrets
        run: |
          if git diff HEAD | grep -iE "(password|secret|key|token)\s*=\s*['\"][^'\"]+['\"]" | grep -v "example\|placeholder\|TODO\|test" > /dev/null; then
            echo "⚠️  ADVERTENCIA: Posibles credenciales hardcodeadas detectadas"
            echo "Por favor revisa el código antes de hacer merge"
          fi

